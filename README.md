## Enterprise Web Development module - Serverless REST Assignment.

**Name:** Ngozi Thelma Nwanesindu

**Demo:** [https://youtu.be/x1Fk9hat84U]

### Overview.

This repository contains a serverless REST API for movie reviews built using AWS CDK. The application allows users to view, add, update, and translate movie reviews. It includes authentication via AWS Cognito and data persistence with DynamoDB. The API is secured with custom authorizers to ensure only authenticated users can add or update reviews.

### App API endpoints.

- GET /movies/reviews/[movieId] - Get all the reviews for the specified movie.
- POST /movies/reviews - add a movie review. Only authenticated users can post a review.
- GET /movies/reviews/[movieId]?reviewerName=user9@example.com - Get all the reviews for the specified movie. Also support a query string that specifies a reviewer identity (email address).
- GET /movies/reviews/movieId?reviewId - Get all the reviews for the specified movie. Also support a query string that specifies a review ID.
- PUT /movies/reviews/movieId/reviewId - Update the text of a review.
- GET - movies/reviews/520756/7/translation?language=code - Get a translated version of a movie review, using the movie ID and review Id as the identifier.

### Features.

#### Translation persistence (if completed)

The application uses DynamoDB to store movie reviews with a structure that supports translations. When a translation is requested, the AWS Translate service is used to translate the review content, and the result is sent back to the client.

The reviews table structure:

- MovieId (Partition key) - Number
- ReviewId (Sort key) - Number (Autogenerated)
- ReviewerId - String (reviewer email address)
- ReviewDate - String, e.g. "2025-01-20". Updatable.
- Content - String (the review text). Updatable.
- Translations - Translations are stored as part of the review data. The application supports on-demand translation through the dedicated translation endpoint.

#### Custom L2 Construct (if completed)

The application uses two custom L2 constructs to organize the infrastructure: AuthApi and AppApi.

AppApi Construct Input props object:

```
type AppApiProps = {
  userPoolId: string;
  userPoolClientId: string;
};
```

AuthApi Construct Input props object:

```
type AuthApiProps = {
  userPoolId: string;
  userPoolClientId: string;
};
```

AuthApi Construct public properties:

```
export class AuthApi extends Construct {
  private auth: apig.IResource;
  private userPoolId: string;
  private userPoolClientId: string;
}
```

The AuthApi construct provisions:

- A REST API for authentication operations
- Lambda functions for signup, signin, signout, and confirm signup
- API Gateway resources and methods for each authentication operation

The AppApi construct provisions:

- DynamoDB table for reviews
- Lambda functions for getting, adding, updating, and translating reviews
- API Gateway resources, methods, and request validators for the reviews API
- Request authorizer for protected endpoints

#### Restricted review updates (if completed)

The application implements restricted add review and review updates through custom authorization. When a user attempts to update a review or add a review, the request must include authentication credentials which are validated by the custom authorizer Lambda function. The authorizer checks the user's identity from the authentication cookie and ensures they have proper permissions before allowing the update.

The updateReview and addReview Lambda functions handles the request, and it's secured by the requestAuthorizer, which is configured to use the authorizerFn Lambda function for authorization.

#### API Gateway validators. (if completed)

The application uses API Gateway validators to ensure request data meets expected requirements. Validators are applied to several endpoints:

1. POST /movies/reviews - For adding a new review
2. PUT /movies/reviews/{movieId}/{reviewId} - For updating a review
3. GET /movies/reviews/{movieId} - To validate the movieId path parameter
4. GET /movies/reviews/{movieId}/{reviewId}/translation - To validate path and query parameters

Here's the code excerpt that illustrates the implementation of validators:

```typescript
const requestValidator = new apig.RequestValidator(this, "RequestValidator", {
  restApi: api,
  validateRequestBody: true,
  validateRequestParameters: true,
});

const reviewModel = api.addModel("ReviewModel", {
  contentType: "application/json",
  modelName: "ReviewModel",
  schema: {
    schema: apig.JsonSchemaVersion.DRAFT4,
    title: "reviewModel",
    type: apig.JsonSchemaType.OBJECT,
    required: ["movieId", "reviewer_id", "content"],
    properties: {
      movieId: { type: apig.JsonSchemaType.NUMBER },
      reviewer_id: { type: apig.JsonSchemaType.STRING },
      content: { type: apig.JsonSchemaType.STRING },
      review_date: {
        type: apig.JsonSchemaType.STRING,
        pattern: "^\\d{4}-\\d{2}-\\d{2}$", // YYYY-MM-DD format
      },
    },
  },
});

// Examples of validator usage on endpoints:
reviewsEndpoint.addMethod("POST", new apig.LambdaIntegration(newReviewFn), {
  authorizer: requestAuthorizer,
  authorizationType: apig.AuthorizationType.CUSTOM,
  requestModels: { "application/json": reviewModel },
  requestValidator,
});

translationResource.addMethod(
  "GET",
  new apig.LambdaIntegration(translateReviewFn),
  {
    requestValidator,
    requestParameters: {
      "method.request.path.movieId": true,
      "method.request.path.reviewId": true,
      "method.request.querystring.language": true, // Required parameter
    },
  }
);
```

### Extra (If relevant).

The implementation includes several CDK/serverless features not covered in the lectures:

1. AWS Translate Service Integration - The application uses the AWS Translate service to provide on-demand translation of review content.

2. Custom Request Validators with JSON Schema - I implemented detailed request validation using API Gateway's request validators with custom JSON schemas to ensure data integrity.

3. IAM Policy Configuration - The translate function has specific IAM permissions configured to allow it to use the AWS Translate service.

4. Resources and references used:
   - https://www.youtube.com/watch?v=yRzzUjE0rzk
   - https://dev.to/rahulmlokurte/how-to-validate-requests-to-the-aws-api-gateway-using-cdk-291c
   - https://docs.aws.amazon.com/translate/latest/dg/what-is.html
   - https://completecoding.io/typescript-translation-api/